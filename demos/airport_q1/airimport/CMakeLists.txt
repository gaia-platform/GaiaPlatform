#############################################
# Copyright (c) Gaia Platform LLC
# All rights reserved.
#############################################

cmake_minimum_required(VERSION 3.11)

# starting point
set(GAIA_REPO ../../..)

# Set the project name.
project(airimport)

set(GAIA_INC ${GAIA_REPO}/production/inc)
set(GAIA_FLATBUFFERS ${GAIA_REPO}/third_party/production/flatbuffers)
set(GAIA_COMPILE_FLAGS "-c -Wextra -ggdb")
set(GAIA_LINK_FLAGS "-ggdb")

set(GAIA_COMMON_INCLUDES 
  ${GAIA_INC}/public/common
  ${GAIA_INC}/internal/common
  ${GAIA_REPO}/demos/airport_q1/inc
  ${GAIA_REPO}/third_party/production/flatbuffers/include
  ${CMAKE_CURRENT_BINARY_DIR}
)
message(STATUS "GAIA_COMMON_INCLUDES=${GAIA_COMMON_INCLUDES}")

set (AIRIMPORT_INCLUDES
  ${GAIA_COMMON_INCLUDES}
  ${GAIA_REPO}/production/db/storage_engine/mock
)
include_directories(${AIRIMPORT_INCLUDES})

add_custom_command(
  OUTPUT "${CMAKE_CURRENT_BINARY_DIR}/airport_q1_generated.h"
  COMMAND ../${GAIA_FLATBUFFERS}/build/flatc --cpp --gaiacpp --gen-mutable --gen-setters
    --gen-object-api --cpp-str-type gaia::common::nullable_string_t --cpp-str-flex-ctor
    -o ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_SOURCE_DIR}/../inc/airport_q1.fbs
  DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/../inc/airport_q1.fbs
  COMMENT "Compiling airport_q1.fbs"
)

add_custom_target(headers_generated
  DEPENDS "${CMAKE_CURRENT_BINARY_DIR}/airport_q1_generated.h")

add_executable(airimport data_loader.cpp)
add_dependencies(airimport headers_generated)

target_link_directories(airimport
  PRIVATE
  ${GAIA_REPO}/production/build/direct_access
  ${GAIA_REPO}/production/build/rules/event_manager
  ${GAIA_REPO}/production/build/db/storage_engine
  ${GAIA_REPO}/production/build/system
)

target_link_libraries(airimport PRIVATE rt gaia gaia_direct gaia_semock)

set_target_properties(airimport PROPERTIES COMPILE_FLAGS "${GAIA_COMPILE_FLAGS}")
set_target_properties(airimport PROPERTIES LINK_FLAGS "${GAIA_LINK_FLAGS}")
