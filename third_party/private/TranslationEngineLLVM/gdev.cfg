[apt]
build-essential
clang-8
python3
git
ssh

[gaia]
production
third_party/production/cmake

[run]
--mount=type=ssh \
mkdir -p -m 0600 ~/.ssh
ssh-keyscan github.com >> ~/.ssh/known_hosts
rm -rf include
rm -rf lib
rm -rf tools
rm -rf TranslationEngineLLVM
git clone git@github.com:gaia-platform/TranslationEngineLLVM.git
cd TranslationEngineLLVM
git checkout f18817f49379d76bd725c4c8c5f4fcafe3a614c5
rm -rf .git
rm -rf ~/.ssh
rm -rf /usr/lib/gcc/x86_64-linux-gnu/10
cmake -DLLVM_ENABLE_EH=ON \
    -DCMAKE_BUILD_TYPE=Release \
    -DLLVM_ENABLE_PROJECTS=clang \
    -DLLVM_ENABLE_RTTI=ON \
    -DGAIA_SOURCE={source_dir('')} \
    -DGAIA_PROD_BUILD={build_dir('production')} \
    -G "Unix Makefiles" \
    {build_dir('third_party/private/TranslationEngineLLVM')}/TranslationEngineLLVM/llvm
make -j$(nproc)
