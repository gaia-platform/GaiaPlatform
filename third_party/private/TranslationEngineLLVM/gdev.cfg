[apt]
build-essential
cmake
libxml2
libxml2-dev
git
python3
python3-dev

[env]
CC=/usr/bin/gcc
CXX=/usr/bin/g++

[gaia]
production

[pre_run]
--mount=type=ssh \
mkdir -p -m 0600 ~/.ssh
ssh-keyscan github.com >> ~/.ssh/known_hosts
git clone git@github.com:gaia-platform/TranslationEngineLLVM.git
cd TranslationEngineLLVM
git checkout 1af7b3fb640599c94a5a7c05c1cfd4e6519b9524
rm -rf .git
rm -rf ~/.ssh

[run]
cmake -DCMAKE_BUILD_TYPE=Release \
    -DLLVM_ENABLE_EH=ON \
    -DLLVM_ENABLE_PROJECTS=clang \
    -DLLVM_ENABLE_RTTI=ON \
    -DGAIA_SOURCE={source_dir('')} \
    -DGAIA_PROD_BUILD={build_dir('production')} \
    -G "Unix Makefiles" \
    TranslationEngineLLVM/llvm
make -j$(nproc)
