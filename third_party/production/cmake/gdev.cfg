[apt]
apt-transport-https
ca-certificates
gnupg
lsb-release
software-properties-common
wget
clang-10
# libc++ is needed for MSan
libc++-10-dev
libc++abi-10-dev
# lld is needed to build LLVM with libc++
lld-10

[env]
CC=/usr/bin/clang-10
CPP=/usr/bin/clang-cpp-10
CXX=/usr/bin/clang++-10
LDFLAGS="-B/usr/lib/llvm-10/bin/ -fuse-ld=lld"

[pre_run]
# This ensures that the LLVM toolchain works as expected.
update-alternatives --install "/usr/bin/clang" "clang" "/usr/bin/clang-10" 10
update-alternatives --install "/usr/bin/clang++" "clang++" "/usr/bin/clang++-10" 10
update-alternatives --install "/usr/bin/ld.lld" "ld.lld" "/usr/bin/ld.lld-10" 10

update-alternatives --install "/usr/bin/cc" "cc" "$CC" 50
update-alternatives --install "/usr/bin/c++" "c++" "$CXX" 50
update-alternatives --install "/usr/bin/cpp" "cpp" "$CPP" 50

[run]
wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | gpg --dearmor - | tee /etc/apt/trusted.gpg.d/kitware.gpg >/dev/null
echo "deb https://apt.kitware.com/ubuntu/ $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/kitware.list
apt-get update
DEBIAN_FRONTEND=noninteractive apt-get install -y \
    cmake \
    cmake-data
apt-get clean
rm /etc/apt/sources.list.d/kitware.list >/dev/null
rm /etc/apt/trusted.gpg.d/kitware.gpg >/dev/null
