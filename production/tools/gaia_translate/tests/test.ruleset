#include "gaia/logger.hpp"
#include "gaia/events.hpp"

int g_rule_called = 0;
int g_insert_called = 0;
int g_update_called = 0;
int g_actuator_rule_called = 0;

ruleset test
{
    OnUpdate(incubator.min_temp)
    {
        gaia_log::app().warn("[rule-1] begin {} {} {} {}", rule_context.ruleset_name, rule_context.rule_name, rule_context.event_type, rule_context.gaia_type);

        max_temp = sensor.value + min_temp;
        max_temp = sensor.value + 4;
        if (actuator.value > 0)
        {
            g_actuator_rule_called++;
        }

        if (sensor.value > 5)
        {
            actuator.value = 1000;
        }
        g_update_called++;
        g_rule_called++;
    }

    OnChange(sensor.value)
    {
        gaia_log::app().warn("[rule-1] begin {} {} {} {}", rule_context.ruleset_name, rule_context.rule_name, rule_context.event_type, rule_context.gaia_type);

        max_temp = sensor.value + min_temp;
        max_temp = sensor.value + 4;
        if (actuator.value > 0)
        {
            g_actuator_rule_called++;
        }

        if ((const gaia::db::triggers::event_type_t)rule_context.event_type == gaia::db::triggers::event_type_t::row_insert)
        {
            g_insert_called++;
        }

        if ((const gaia::db::triggers::event_type_t)rule_context.event_type == gaia::db::triggers::event_type_t::row_update)
        {
            if (sensor.value > 5)
            {
                actuator.value = 1000;
            }
            g_update_called++;
        }
        g_rule_called++;
    }
}

ruleset test2
{
}
