/////////////////////////////////////////////
// Copyright (c) Gaia Platform LLC
// All rights reserved.
/////////////////////////////////////////////

#include <string>

#include "gaia/logger.hpp"

#include "constants.hpp"
#include "gaia_ping_pong.h"

using namespace std;

constexpr int c_log_heartbeat_frequency = 10000;

ruleset ping_pong
{
    {
        static int count = 0;
        count++;

        if (count % c_log_heartbeat_frequency)
        {
            // If, for whatever reason, the next condition is never met, at least we log something.
            gaia_log::app().info("Rules:{} iteration:{}", ping_pong.status, count);
        }

        if (strcmp(ping_pong.status, c_ping) == 0)
        {
            gaia_log::app().info("Rules:{}->{} iteration:{} txn_id:{}", ping_pong.status, c_pong, count, 0 /* txn_id not exposed yet */);
            // If I dont' use a fully qualified name, it will fail here.
            status = c_pong;
        }
    }
}
